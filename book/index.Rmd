--- 
title: "EcoSHEDS Northeast Brook Trout Occupancy Model"
author: "[Jeffrey D. Walker](https://walkerenvres.com), [Benjamin Letcher](https://www.usgs.gov/staff-profiles/benjamin-h-letcher)"
date: "v2.0.0 (July 8, 2022)"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [references.bib]
biblio-style: apalike
csl: https://raw.githubusercontent.com/robertour/apalike-zotero/master/apalike.csl
csl-entry-spacing: 1em
link-citations: yes
github-repo: EcoSHEDS/northeast-bto-model
description: "Documentation for the EcoSHEDS Northeast Brook Trout Occupancy Model."
editor_options: 
  chunk_output_type: console
---

```{r setup, echo = FALSE}
library(tidyverse)
library(patchwork)
library(sf)
library(caret)
library(janitor)
library(glue)
library(targets)

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, comment = NA)

tar_config_set(store = "../_targets")
```

# Introduction {#intro}

The northeast brook trout occupancy model predicts the occupancy probability of eastern brook trout based on estimated stream temperatures across a high resolution catchment delineation for the northeast U.S. (Maine to Virginia). This model is developed and maintained as part of the [EcoSHEDS](https://www.usgs.gov/apps/ecosheds/) project.

## Model Summary

The occupancy model is a logistic linear mixed effects model for predicting occupancy probability based on estimated stream temperature. The primary model input is the estimated mean July stream temperature generated by the [EcoSHEDS Northeast Stream Temperature Model](https://ecosheds.org/models/stream-temperature/latest/) and averaged over all years from 1980 to present. The model also includes a varying intercept (random effect) based on the HUC8^[8-digit Hydrologic Unit Code (HUC)] basin containing each catchment to account for regional variations in occupancy not explained by stream temperature. Like the EcoSHEDS stream temperature model, the occupancy model domain is based on the [EcoSHEDS Northeast Catchment Delineation](https://conte-ecology.github.io/shedsGisData/#the-national-hydrography-dataset-high-resolution-delineation-version-2-nhdhrdv2). 

The occupancy model was calibrated using presence/absence data compiled from multiple state agencies across the region.

```{r intro-obs-map, fig.cap="Map of Presence/Absence by Catchment"}
tar_read(obs_presence_map)
```

The model was validating by splitting the observed presence/absence data into independent training and testing subsets, calibrating the model to the training data, and then comparing the model performance between the two subsets. The validation confirmed that the model structure is not susceptible to over-fitting. Following validation, the model was re-calibrated using all available observation data in order to maximize the amount of information used to generate the final predictions. The following table summarizes the model performance for each dataset.

```{r intro-model-compare}
tar_read(predict_model_gof_compare) |> 
  rename(Metric = stat, Calibration = calib, Validation = valid, `Full (Prediction)` = pred) |> 
  knitr::kable(align = "lrrr")
```

Predicted occupancy probabilities were generated for each catchment under both historical conditions as well as for a series of simple climate change scenarios (e.g., +2, +4, +6 degC air temperature). Additional metrics were also computed to evaluate the vulnerability of brook trout occupancy within each catchment to climate change (e.g., the maximum air temperature increase that would result in 30, 50, or 70% occupancy). Model predictions were only generated for catchments with cumulative drainage areas less than 200 km^2^ (i.e., lower order streams) due to the complexity of predicting stream temperatures in larger rivers.

```{r intro-map-prob, fig.height=6, fig.cap="Predicted Occupancy Probabilities under Historical and Future Climate Change Scenarios"}
tar_read(predict_pred_map_prob)
```

```{r intro-map-max, fig.height=6, fig.cap="Predicted Max. Air Temperature Increases to Achieve Varying Occupancy Probabilities"}
tar_read(predict_pred_map_max)
```

The predicted occupancy probabilities along with stream temperature predictions and various catchment characteristics can be found in the [Northeast Interactive Catchment Explorer (ICE)](https://www.usgs.gov/apps/ecosheds/ice-northeast/). Data files containing the predictions are also available for download (see [Downloads]).

The model is periodically updated when either new observation data are available, or following each update of the northeast stream temperature model. Currently, updates are being performed annually, usually in the fall.

## Documentation

The documentation is divided into the following sections:

1. [Introduction] provides an overview the model and its documentation
1. [Data Sources] describes the data sources and data processing steps used to generate the model inputs and observed data
1. [Model Development] describes the model structure and implementation
1. [Calibration and Validation] summarizes the model calibration and validation
1. [Predictions] describes the model prediction scenarios and metrics
1. [Downloads] provides links to download the model predictions
1. [History] contains a list of changes to the model over time

## Source Code

The source code for the model itself and this documentation is available in the Github repository [EcoSHEDS/northeast-bto-model](https://github.com/EcoSHEDS/northeast-bto-model). Each version of the model will be included under the list of [Releases](https://github.com/EcoSHEDS/northeast-bto-model/releases).

